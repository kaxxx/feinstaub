<html>                                                                                                                            
<head>
  <link type="text/css" rel="stylesheet" href="{{ url_for('static',    filename='plotly.css') }}" />
</head>
<body>                                                                                                                            
<script src="https://code.jquery.com/jquery-latest.js"                                                                            
type="text/javascript"></script>                                                                                                  
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<!--script src="./jquery.switchButton.js"></script-->

<div id="meta"></div>
<div id="ppm25" style="float:left;"></div>                                                                                        
<div id="ppm10" style="float:right;"></div>
<div id="spinner"><img src="https://faviconer.net/preloaders/89/Fading%20line.gif"/></div>
<div id="diagram"></div>
<script>
    var x10=new Array();
    var y10=new Array();
    var x25=new Array();
    var y25=new Array();

  $( document ).ready(function() {
    $("#spinner").show();
    // start one time
    readData();
  });

  $(window).resize(function(){
    console.log("resizing ...");
    reDrawData();
    //Plotly.restyle('diagram', {});
  });

  function mkArray(json){
    console.log(json);
    $.each(json, function(key, obj) {
      console.log(key);

	  x10.push(key);
	  y10.push(obj[0].ppm10);

	  x25.push(key);
	  y25.push(obj[0].ppm25);
	  drawData();

    });
  }

  function mkArray2(json){
    x10 = json["x10"];
    y10 = json["y10"];

    x25 = json["x25"];
    y25 = json["y25"];

    $("#meta").html(niceMeta(json["meta"]));

    console.log(json["meta"]["from"]);
    drawData();
  }

  function niceMeta(meta){
    return meta["results"]+" results - from: "+meta['from']+" to: "+meta['to'];
  }

  function readData(){
   $.ajax({
     {% if days %}
      url: "/fs/api/v1.0/pl/lastdays/{{days}}",
     {% elif sfrom %}
      url: "/fs/api/v1.0/pl/range/{{sfrom}}/{{sto}}",
     {% endif %}
      async: true,
      timeout: 99999999,
      success: mkArray2
    });
  }

  function drawData(){
    var trace1 = {
      x: x25,
      y: y25,
      type: 'scatter',
      name: 'ppm2.5'
    };
    var trace2 = {
      x: x10,
      y: y10,
      type: 'scatter',
      name: 'ppm10'
    };
    var data = [trace2, trace1];
    Plotly.newPlot('diagram', data);
    $("#spinner").hide();
    $("#diagram").show();
  }

  function reDrawData(){
    var update = {
      width: $( "body" ).width()
    };
    console.log(update);
    Plotly.relayout('diagram', update);
  }
</script>
</body>                                                                                                                           
</html>           
